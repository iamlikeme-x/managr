<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>User Profile</title>

        <link rel="stylesheet" href="css/style.css">
        <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
        <script src="./js/jquery-2.2.0.min.js"></script><!-- jQuery -->
        <script src="./js/main.js"></script>
        <script src="./js/config.js"></script>
        <!-- OAuth.js & Dependencies-->
        <script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/hmac-sha1.js"></script>
        <script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/hmac-sha256.js"></script>
        <script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/components/enc-base64-min.js"></script>
        <script src="./js/oauth.min.js"></script>
        
        <script src="./js/authenticate.js"></script>
    </head>
    <body>
        <div class="wrapper" id="header">
            <header>
                <!--Logo Image-->
                <a href="index.html" id="logocntnr"><img src="./img/logo.png" alt="Logo" id="logo"></a>
                
                <!--Hamburger Menu-->
                <a href="javascript:;" id="settingsbutton"><img src="./img/menu-icon.svg" alt="login" id="hamburger"></a>
                <div id="settingsmenu">
                    <h2>Menu</h2>
                    <ul>
                        <li><a href="javascript:;"><img src="./img/upload-icon.svg" alt="Upload">Upload</a></li>
                        <li><a id="login" href="javascript:;">login</a></li>
                        <li><a href="javascript:;">blah</a></li>
                        <li><a href="javascript:;">blah</a></li>
                    </ul>

                    <div id="account"></div>
                </div>
                    
                <!--Filter icon and menu -->
                <img src="img/icon-filter.png" alt="Filter" id="filter">
                <div id="filtermenu">
                    <h2>Filter</h2>
                    <div class="colours">
                        <div class="colour" id="red" data-colors="redviolet,red,redorange,yelloworange" data-title="Red"></div>
                        <div class="colour" id="blue"data-colors="bluegreen,blue,blueviolet,violet"></div>
                        <div class="colour" id="green" data-colors="yellowgreen,green,bluegreen"></div>
                        <div class="colour" id="yellow" data-colors="yelloworange,orange,redorange"></div>
                        <div class="colour" id="black" data-colors="black,grey"></div>
                        <div class="colour" id="x" data-colors=''></div>
                    </div>
                </div>
            </header>
        </div>
        
        <div class="wrapper" id="content">
            <img src="https://www.flickr.com/images/buddyicon.gif" alt="" id="profile-pic">
            <h2 id="name"></h2>
            <p id="bio"></p>
            <p id="location"></p>
        </div>
   
        
        <script>
            $(function(){
                var params = window.location.search.substring(1);
                params = JSON.parse('{"' + decodeURI(params).replace(/"/g, '\\"').replace(/&/g, '","').replace(/=/g,'":"') + '"}');
                
                var data = {
                    url: 'https://api.flickr.com/services/rest/',
                    method: 'GET',
                    data: {
                        api_key: 'f558724ba49174dc32d3828d1a7302cd',
                        user_id: params.nsid,
                        method: 'flickr.people.getInfo',
                        jsoncallback: 'loadUserInfo',
                        format: 'json',
                    }                    
                };
                
                var data = signUrl(data, true);
                $.ajax({
                    method: 'GET',
                    url: 'https://api.flickr.com/services/rest/',
                    data: data,
                    dataType: 'jsonp'
                });
            });
            function loadUserInfo(info){
                console.log(info);
                var username = info.person.username._content;
                if(username.substr(username.length - 1) == 's'){
                    $('title').text(username+'\' profile');
                }else{
                    $('title').text(username+'\'s profile');
                }
                
                var iconFarm = info.person.iconfarm;
                var iconServer = info.person.iconserver;
                var nsid = info.person.nsid;
                var profilePicUrl = 'http://farm'+iconFarm+'.staticflickr.com/'+iconServer+'/buddyicons/'+nsid+'_r.jpg';
                if(parseInt(iconFarm) != 0){
                    $('#profile-pic').attr('src', profilePicUrl);
                }
                if(info.person.realname){
                    var fullName = info.person.realname._content;
                } else {
                    var fullName = false;
                }
                if(fullName){
                    $('#name').text(fullName);
                }
                
                var bio = info.person.description._content;
                if(bio){
                    bio = $(bio)
                    bio.find('a img').each(function() {
                        console.log('unbinding '+this);
                        $(this).off('click');
                    });
                    console.log(bio);
                    $('#bio').html(bio);
                }else{
                    $('#bio').text('User has no description!');
                }
                if(info.person.location){
                    var location = info.person.location._content;
                    $('#location').text(location);
                }else{
                    var location = false;
                    $('#location').text('Location not set');
                }
            }
        </script>
    </body>
</html>